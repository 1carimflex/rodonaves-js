!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("axios"),require("qs"),require("tls")):"function"==typeof define&&define.amd?define(["axios","qs","tls"],factory):(global=global||self).Rodonaves=factory(global.axios,global.Qs,global.tls)}(this,(function(axios,qs,tls){"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}axios=axios&&Object.prototype.hasOwnProperty.call(axios,"default")?axios.default:axios,qs=qs&&Object.prototype.hasOwnProperty.call(qs,"default")?qs.default:qs,tls=tls&&Object.prototype.hasOwnProperty.call(tls,"default")?tls.default:tls;class RodonavesFetchServerError extends Error{constructor(status){super("Server error status ".concat(status," ")),this.name="RodonavesFetchServerError"}}class RodonavesFetchClientError extends Error{constructor(){super("Client error"),this.name="RodonavesFetchClientError"}}class RodonavesFetchOtherError extends Error{constructor(){super("Other Error"),this.name="RodonavesFetchOtherError"}}function _ref(){return(_ref=_asyncToGenerator((function*(url){var method=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",params=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},data=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},contentType=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"application/json",headers={"Content-Type":contentType};this.token&&(headers.Authorization="Bearer ".concat(this.token));var transformedData=data;"multipart/form-data"===contentType&&(transformedData=qs.stringify(data));try{var response=yield axios({baseURL:"https://01wapi.rte.com.br/",method:method,url:url,timeout:this.timeout,headers:headers,params:params,data:transformedData});return response.data}catch(error){throw error.response?new RodonavesFetchServerError(error.response.status):error.request?new RodonavesFetchClientError:new RodonavesFetchOtherError}}))).apply(this,arguments)}function _auth(){return(_auth=_asyncToGenerator((function*(){var data=yield this.fetch("/token","POST",void 0,{auth_type:this.mode,grant_type:"password",username:this.username,password:this.password},"multipart/form-data");return this.token=data.access_token,!0}))).apply(this,arguments)}function _ref$1(){return(_ref$1=_asyncToGenerator((function*(zipCode){var filteredZipCode=zipCode.match(/\d+/g).join("");return this.token||(yield this.auth()),this.fetch("/api/v1/busca-por-cep","GET",{zipCode:filteredZipCode})}))).apply(this,arguments)}function _ref$2(){return(_ref$2=_asyncToGenerator((function*(originZipCode,destinationZipCode,packs,invoiceValue,destinationTaxId){if(!packs||0===packs.length)throw new Error("Packs can not be null or empty");this.token||(yield this.auth());var totalPacksWeight=0;packs.forEach(pack=>{totalPacksWeight+=pack.weight});var filteredOriginZipCode=originZipCode.match(/\d+/g).join(""),filteredDestinationZipCode=destinationZipCode.match(/\d+/g).join(""),[originCityData,destinationCityData]=yield Promise.all([this.getCityByZipCode(filteredOriginZipCode),this.getCityByZipCode(filteredDestinationZipCode)]),data={OriginCityId:originCityData.CityId,OriginZipCode:originZipCode,DestinationCityId:destinationCityData.CityId,DestinationZipCode:destinationZipCode,TotalWeight:totalPacksWeight,EletronicInvoiceValue:invoiceValue,CustomerTaxIdRegistration:destinationTaxId,Packs:packs.map(pack=>({AmountPackages:1,Weight:pack.weight,Length:pack.length,Height:pack.height,Width:pack.width}))};return this.fetch("/api/v1/simula-cotacao","POST",{},data)}))).apply(this,arguments)}function _ref$3(){return(_ref$3=_asyncToGenerator((function*(originZipCode,destinationZipCode){var filteredOriginZipCode=originZipCode.match(/\d+/g).join(""),filteredDestinationZipCode=destinationZipCode.match(/\d+/g).join("");this.token||(yield this.auth());var[originCityData,destinationCityData]=yield Promise.all([this.getCityByZipCode(filteredOriginZipCode),this.getCityByZipCode(filteredDestinationZipCode)]),data={OriginCityDescription:originCityData.CityDescription,OriginUFDescription:originCityData.UnitFederation.Description,DestinationCityDescription:destinationCityData.CityDescription,DestinationUFDescription:destinationCityData.UnitFederation.Description},{DeliveryTime:DeliveryTime}=yield this.fetch("/api/v1/prazo-entrega","POST",{},data);return DeliveryTime}))).apply(this,arguments)}function Rodonaves(username,password){var mode=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"dev",timeout=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.mode=mode,this.username=username,this.password=password,this.timeout=timeout,this.token=null}return tls&&(tls.DEFAULT_MIN_VERSION="TLSv1"),Rodonaves.prototype={},Rodonaves.prototype.constructor=Rodonaves,Rodonaves.prototype.fetch=function(_x){return _ref.apply(this,arguments)},Rodonaves.prototype.auth=function(){return _auth.apply(this,arguments)},Rodonaves.prototype.getCityByZipCode=function(_x){return _ref$1.apply(this,arguments)},Rodonaves.prototype.getDeliveryTime=function(_x,_x2){return _ref$3.apply(this,arguments)},Rodonaves.prototype.simulateQuote=function(_x,_x2,_x3,_x4,_x5){return _ref$2.apply(this,arguments)},Rodonaves}));